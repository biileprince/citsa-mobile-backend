### CITSA Mobile Backend API Tests
### Using REST Client Extension for VS Code
### 
### Instructions:
### 1. Click "Send Request" above each request
### 2. Check server console for OTP code after Step 1
### 3. Copy OTP and update @otpCode variable below
### 4. Run steps sequentially
###
### ================================================================

### Variables
@baseUrl = http://localhost:3000/api/v1
@studentId = PS/ITC/22/0001
@otpCode = 242292
# @accessToken will be set automatically from Step 2 response
# @refreshToken will be set automatically from Step 2 response

### ================================================================
### STEP 1: Send OTP
### Check server console for the OTP code after this request
### ================================================================
POST {{baseUrl}}/auth/send-otp
Content-Type: application/json

{
  "studentId": "{{studentId}}"
}

### ================================================================
### STEP 1B: Resend OTP (if needed)
### Invalidates previous OTP and sends a new one
### ================================================================
POST {{baseUrl}}/auth/resend-otp
Content-Type: application/json

{
  "studentId": "{{studentId}}"
}

### ================================================================
### STEP 2: Verify OTP
### Update @otpCode variable above with the code from server console
### ================================================================
# @name verifyOtp
POST {{baseUrl}}/auth/verify-otp
Content-Type: application/json

{
  "studentId": "{{studentId}}",
  "otpCode": "{{otpCode}}"
}

### Extract tokens for subsequent requests
@accessToken = {{verifyOtp.response.body.data.accessToken}}
@refreshToken = {{verifyOtp.response.body.data.refreshToken}}

### ================================================================
### STEP 3: Setup Profile (if needsProfileSetup was true)
### ================================================================
PUT {{baseUrl}}/users/profile
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "fullName": "Test Student",
  "bio": "A passionate student at UCC",
  "program": "Information Technology",
  "classYear": "2026",
  "skills": ["Flutter", "Dart", "Node.js", "TypeScript"],
  "interests": ["Mobile Development", "Web Development", "AI"],
  "portfolioUrl": "https://github.com/teststudent"
}

### ================================================================
### STEP 4: Get User Profile
### ================================================================
GET {{baseUrl}}/users/profile
Authorization: Bearer {{accessToken}}

### ================================================================
### STEP 5: Refresh Access Token
### ================================================================
# @name refreshToken
POST {{baseUrl}}/auth/refresh-token
Content-Type: application/json

{
  "refreshToken": "{{refreshToken}}"
}

### Update access token with new one
@accessToken = {{refreshToken.response.body.data.accessToken}}

### ================================================================
### STEP 6: Test with New Access Token
### ================================================================
GET {{baseUrl}}/users/profile
Authorization: Bearer {{accessToken}}

### ================================================================
### FEED ENDPOINTS
### ================================================================

### ================================================================
### Get All Posts (Public - No Auth Required)
### ================================================================
GET {{baseUrl}}/feed/posts

### ================================================================
### Get All Posts (Authenticated - includes like/save status)
### ================================================================
GET {{baseUrl}}/feed/posts
Authorization: Bearer {{accessToken}}

### ================================================================
### Get Posts with Pagination
### ================================================================
GET {{baseUrl}}/feed/posts?page=1&limit=10
Authorization: Bearer {{accessToken}}

### ================================================================
### Filter Posts by Type - ANNOUNCEMENT
### ================================================================
GET {{baseUrl}}/feed/posts?type=ANNOUNCEMENT
Authorization: Bearer {{accessToken}}

### ================================================================
### Filter Posts by Type - EVENT
### ================================================================
GET {{baseUrl}}/feed/posts?type=EVENT
Authorization: Bearer {{accessToken}}

### ================================================================
### Filter Posts by Type - OPPORTUNITY
### ================================================================
GET {{baseUrl}}/feed/posts?type=OPPORTUNITY
Authorization: Bearer {{accessToken}}

### ================================================================
### Filter Posts by Category - POSITIVE_NEWS
### ================================================================
GET {{baseUrl}}/feed/posts?category=POSITIVE_NEWS
Authorization: Bearer {{accessToken}}

### ================================================================
### Filter Posts by Category - EVENTS
### ================================================================
GET {{baseUrl}}/feed/posts?category=EVENTS
Authorization: Bearer {{accessToken}}

### ================================================================
### Search Posts by Keyword
### ================================================================
GET {{baseUrl}}/feed/posts?search=hackathon
Authorization: Bearer {{accessToken}}

### ================================================================
### Combined Filters - Type + Search
### ================================================================
GET {{baseUrl}}/feed/posts?type=ANNOUNCEMENT&search=welcome
Authorization: Bearer {{accessToken}}

### ================================================================
### Get Single Post by ID (replace {postId} with actual ID)
### ================================================================
@postId ="659bc47f-29db-475f-bf38-1e50c148c977"
GET {{baseUrl}}/feed/posts/{{postId}}
Authorization: Bearer {{accessToken}}

### ================================================================
### Create Announcement Post (Admin Only)
### ================================================================
# @name createPost
POST {{baseUrl}}/feed/posts
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "type": "ANNOUNCEMENT",
  "category": "POSITIVE_NEWS",
  "title": "Test Announcement from REST Client",
  "content": "This is a test announcement created via REST Client. Testing the feed API endpoint for creating posts.",
  "isPinned": false
}

### Save post ID for subsequent tests
@createdPostId = {{createPost.response.body.data.id}}

### ================================================================
### Create Event Post (Admin Only)
### ================================================================
# @name createEventPost
POST {{baseUrl}}/feed/posts
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "type": "EVENT",
  "category": "EVENTS",
  "title": "REST Client Test Event - API Workshop",
  "content": "Join us for a hands-on workshop on API testing using REST Client. Learn best practices and tools.",
  "eventDate": "2026-02-15",
  "eventTime": "14:00",
  "location": "Computer Lab 201",
  "capacityMax": 50,
  "registrationDeadline": "2026-02-10",
  "tags": ["API", "Testing", "Workshop"],
  "isUrgent": false
}

### Save event post ID
@eventPostId = {{createEventPost.response.body.data.id}}

### ================================================================
### Create Opportunity Post (Admin Only)
### ================================================================
POST {{baseUrl}}/feed/posts
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "type": "OPPORTUNITY",
  "category": "OPPORTUNITY",
  "title": "Software Engineering Internship",
  "content": "Tech Corp is hiring software engineering interns for summer 2026. Great opportunity to gain industry experience.",
  "isPinned": false
}

### ================================================================
### Create Pinned Post (Admin Only)
### ================================================================
POST {{baseUrl}}/feed/posts
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "type": "ANNOUNCEMENT",
  "category": "POSITIVE_NEWS",
  "title": "ðŸ”¥ Important: Semester Registration Open",
  "content": "Semester registration is now open! Visit the registrar's office or register online before the deadline.",
  "isPinned": true
}

### ================================================================
### Like a Post
### ================================================================
POST {{baseUrl}}/feed/posts/{{createdPostId}}/like
Authorization: Bearer {{accessToken}}

### ================================================================
### Try to Like Same Post Again (Should Fail with 409)
### ================================================================
POST {{baseUrl}}/feed/posts/{{createdPostId}}/like
Authorization: Bearer {{accessToken}}

### ================================================================
### Unlike a Post
### ================================================================
DELETE {{baseUrl}}/feed/posts/{{createdPostId}}/like
Authorization: Bearer {{accessToken}}

### ================================================================
### Add Comment to Post
### ================================================================
# @name addComment
POST {{baseUrl}}/feed/posts/{{createdPostId}}/comments
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "content": "Great post! This is a test comment from REST Client."
}

### Save comment ID
@commentId = {{addComment.response.body.data.id}}

### ================================================================
### Reply to Comment
### ================================================================
POST {{baseUrl}}/feed/posts/{{createdPostId}}/comments
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "content": "Thanks! This is a reply to the test comment.",
  "parentCommentId": "{{commentId}}"
}

### ================================================================
### Add Multiple Comments
### ================================================================
POST {{baseUrl}}/feed/posts/{{createdPostId}}/comments
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "content": "Another comment for testing purposes."
}

###
POST {{baseUrl}}/feed/posts/{{createdPostId}}/comments
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "content": "One more comment to test the feed functionality."
}

### ================================================================
### Save Post to Bookmarks
### ================================================================
POST {{baseUrl}}/feed/posts/{{createdPostId}}/save
Authorization: Bearer {{accessToken}}

### ================================================================
### Try to Save Same Post Again (Should Fail with 409)
### ================================================================
POST {{baseUrl}}/feed/posts/{{createdPostId}}/save
Authorization: Bearer {{accessToken}}

### ================================================================
### Get Saved Posts
### ================================================================
GET {{baseUrl}}/feed/saved
Authorization: Bearer {{accessToken}}

### ================================================================
### Get Saved Posts with Pagination
### ================================================================
GET {{baseUrl}}/feed/saved?page=1&limit=5
Authorization: Bearer {{accessToken}}

### ================================================================
### Unsave Post
### ================================================================
DELETE {{baseUrl}}/feed/posts/{{createdPostId}}/save
Authorization: Bearer {{accessToken}}

### ================================================================
### Share Post
### ================================================================
POST {{baseUrl}}/feed/posts/{{createdPostId}}/share
Authorization: Bearer {{accessToken}}

### ================================================================
### Get Post Details with Comments
### ================================================================
GET {{baseUrl}}/feed/posts/{{createdPostId}}
Authorization: Bearer {{accessToken}}

### ================================================================
### Complex Query - Filter + Search + Pagination
### ================================================================
GET {{baseUrl}}/feed/posts?type=ANNOUNCEMENT&category=POSITIVE_NEWS&search=test&page=1&limit=5
Authorization: Bearer {{accessToken}}

### ================================================================
### Update Post (Admin Only)
### ================================================================
PUT {{baseUrl}}/feed/posts/{{createdPostId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "UPDATED: Test Announcement from REST Client",
  "content": "This announcement has been updated via REST Client. The content has been modified to test the update functionality.",
  "isPinned": true
}

### ================================================================
### Update Event Post - Change Event Details
### ================================================================
PUT {{baseUrl}}/feed/posts/{{eventPostId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "UPDATED: API Workshop - Advanced Testing",
  "content": "Updated workshop details: Now includes advanced API testing strategies and hands-on exercises.",
  "eventDate": "2026-02-20",
  "eventTime": "15:30",
  "location": "Computer Lab 305 (Changed)",
  "capacityMax": 75,
  "registrationDeadline": "2026-02-15",
  "tags": ["API", "Testing", "Advanced", "Workshop"],
  "isUrgent": true
}

### ================================================================
### EVENT ENDPOINTS
### ================================================================

### ================================================================
### Get All Events (Public - No Auth Required)
### ================================================================
GET {{baseUrl}}/events

### ================================================================
### Get All Events (Authenticated - includes registration status)
### ================================================================
GET {{baseUrl}}/events
Authorization: Bearer {{accessToken}}

### ================================================================
### Get Events with Pagination
### ================================================================
GET {{baseUrl}}/events?page=1&limit=5
Authorization: Bearer {{accessToken}}

### ================================================================
### Get Upcoming Events Only
### ================================================================
GET {{baseUrl}}/events?upcoming=true
Authorization: Bearer {{accessToken}}

### ================================================================
### Search Events by Keyword
### ================================================================
GET {{baseUrl}}/events?search=workshop
Authorization: Bearer {{accessToken}}

### ================================================================
### Combined - Upcoming Events with Search
### ================================================================
GET {{baseUrl}}/events?upcoming=true&search=API&page=1&limit=10
Authorization: Bearer {{accessToken}}

### ================================================================
### Get Single Event by ID (use eventPostId from event post creation)
### ================================================================
# First, get the event ID from the event post
# @name getEventPost
GET {{baseUrl}}/feed/posts/{{eventPostId}}
Authorization: Bearer {{accessToken}}

### Save event ID from response
@eventId = {{getEventPost.response.body.data.event.id}}

### ================================================================
### Get Event Details
### ================================================================
GET {{baseUrl}}/events/{{eventId}}
Authorization: Bearer {{accessToken}}

### ================================================================
### Register for Event
### ================================================================
POST {{baseUrl}}/events/{{eventId}}/register
Authorization: Bearer {{accessToken}}

### ================================================================
### Try to Register Again (Should Fail with 400 - Already Registered)
### ================================================================
POST {{baseUrl}}/events/{{eventId}}/register
Authorization: Bearer {{accessToken}}

### ================================================================
### Get Event After Registration (Should show isRegistered: true)
### ================================================================
GET {{baseUrl}}/events/{{eventId}}
Authorization: Bearer {{accessToken}}

### ================================================================
### Get My Registered Events
### ================================================================
GET {{baseUrl}}/events/my-registrations
Authorization: Bearer {{accessToken}}

### ================================================================
### Get My Upcoming Registered Events
### ================================================================
GET {{baseUrl}}/events/my-registrations?upcoming=true
Authorization: Bearer {{accessToken}}

### ================================================================
### Get My Registered Events with Pagination
### ================================================================
GET {{baseUrl}}/events/my-registrations?page=1&limit=5
Authorization: Bearer {{accessToken}}

### ================================================================
### Cancel Event Registration
### ================================================================
DELETE {{baseUrl}}/events/{{eventId}}/register
Authorization: Bearer {{accessToken}}

### ================================================================
### Try to Cancel Again (Should Fail with 404 - Registration Not Found)
### ================================================================
DELETE {{baseUrl}}/events/{{eventId}}/register
Authorization: Bearer {{accessToken}}

### ================================================================
### Verify Event After Cancellation (Should show isRegistered: false)
### ================================================================
GET {{baseUrl}}/events/{{eventId}}
Authorization: Bearer {{accessToken}}

### ================================================================
### Test Event Capacity - Create Event with Small Capacity
### ================================================================
# @name createSmallEvent
POST {{baseUrl}}/feed/posts
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "type": "EVENT",
  "category": "EVENTS",
  "title": "Small Capacity Event - Testing Full Registration",
  "content": "This event has only 1 spot to test full capacity handling.",
  "eventDate": "2026-03-01",
  "eventTime": "10:00",
  "location": "Meeting Room A",
  "capacityMax": 1,
  "registrationDeadline": "2026-02-28",
  "tags": ["Test"],
  "isUrgent": false
}

### Save small event ID
@smallEventId = {{createSmallEvent.response.body.data.event.id}}

### ================================================================
### Register for Small Capacity Event (Should Succeed)
### ================================================================
POST {{baseUrl}}/events/{{smallEventId}}/register
Authorization: Bearer {{accessToken}}

### ================================================================
### Check Small Event Status (Should show isFull: true, spotsRemaining: 0)
### ================================================================
GET {{baseUrl}}/events/{{smallEventId}}
Authorization: Bearer {{accessToken}}

### ================================================================
### CLASSROOM ENDPOINTS
### ================================================================

### ================================================================
### Create New Classroom (Admin Only)
### ================================================================
# @name createClassroom
POST {{baseUrl}}/classrooms
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "yearGroup": "2026",
  "graduationYear": 2030,
  "semester": 1,
  "isActive": true
}

### Save created classroom ID
@createdClassroomId = {{createClassroom.response.body.data.id}}

### ================================================================
### Create Another Classroom - Semester 2
### ================================================================
POST {{baseUrl}}/classrooms
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "yearGroup": "2026",
  "graduationYear": 2030,
  "semester": 2,
  "isActive": true
}

### ================================================================
### Create Classroom for 2027
### ================================================================
POST {{baseUrl}}/classrooms
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "yearGroup": "2027",
  "graduationYear": 2031,
  "semester": 1,
  "isActive": true
}

### ================================================================
### Try to Create Duplicate Classroom (Should Fail with 409)
### ================================================================
POST {{baseUrl}}/classrooms
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "yearGroup": "2026",
  "graduationYear": 2030,
  "semester": 1
}

### ================================================================
### Get All Classrooms
### ================================================================
GET {{baseUrl}}/classrooms
Authorization: Bearer {{accessToken}}

### ================================================================
### Get All Classrooms with Pagination
### ================================================================
GET {{baseUrl}}/classrooms?page=1&limit=5
Authorization: Bearer {{accessToken}}

### ================================================================
### Get Single Classroom Details
### ================================================================
GET {{baseUrl}}/classrooms/{{createdClassroomId}}
Authorization: Bearer {{accessToken}}

### ================================================================
### Get Single Classroom Details (using ID from list)
### ================================================================
@classroomId = replace-with-actual-classroom-id
GET {{baseUrl}}/classrooms/{{classroomId}}
Authorization: Bearer {{accessToken}}

### ================================================================
### Get Classroom Timetable
### ================================================================
GET {{baseUrl}}/classrooms/{{classroomId}}/timetable
Authorization: Bearer {{accessToken}}

### ================================================================
### Get Classroom Announcements
### ================================================================
GET {{baseUrl}}/classrooms/{{classroomId}}/announcements
Authorization: Bearer {{accessToken}}

### ================================================================
### Get Classroom Announcements with Pagination
### ================================================================
GET {{baseUrl}}/classrooms/{{classroomId}}/announcements?page=1&limit=10
Authorization: Bearer {{accessToken}}

### ================================================================
### Create Classroom Announcement (Class Rep Only)
### ================================================================
# @name createAnnouncement
POST {{baseUrl}}/classrooms/{{classroomId}}/announcements
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "Important: Quiz Rescheduled",
  "content": "The Data Structures quiz originally scheduled for Monday has been moved to Wednesday at 2:00 PM. Please prepare accordingly. Topics covered: Trees, Graphs, and Hash Tables.",
  "isPinned": false,
  "isUrgent": true
}

### Save announcement ID
@announcementId = {{createAnnouncement.response.body.data.id}}

### ================================================================
### Create Regular Announcement
### ================================================================
POST {{baseUrl}}/classrooms/{{classroomId}}/announcements
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "Study Group Session - Database Design",
  "content": "Join us for a collaborative study session on database normalization and ER diagrams. This Saturday at 10 AM in the library. All students welcome!",
  "isPinned": false,
  "isUrgent": false
}

### ================================================================
### Create Pinned Announcement
### ================================================================
POST {{baseUrl}}/classrooms/{{classroomId}}/announcements
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "ðŸ“Œ Course Syllabus and Resources",
  "content": "The complete course syllabus, lecture slides, and recommended readings are now available on the course portal. Please review the materials before our next class.",
  "isPinned": true,
  "isUrgent": false
}

### ================================================================
### Create Urgent Announcement
### ================================================================
POST {{baseUrl}}/classrooms/{{classroomId}}/announcements
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "ðŸš¨ URGENT: Class Canceled Tomorrow",
  "content": "Tomorrow's class (Feb 3rd) is canceled due to an emergency. We will resume on Thursday. Check your email for the assignment that's been posted instead.",
  "isPinned": false,
  "isUrgent": true
}

### ================================================================
### Update Announcement (Class Rep Only)
### ================================================================
PUT {{baseUrl}}/classrooms/{{classroomId}}/announcements/{{announcementId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "UPDATED: Quiz Rescheduled to Thursday",
  "content": "Update: The quiz has been moved again to Thursday at 3:00 PM (not Wednesday). Apologies for the confusion. Same topics: Trees, Graphs, Hash Tables.",
  "isPinned": true,
  "isUrgent": true
}

### ================================================================
### Delete Announcement (Class Rep Only)
### ================================================================
DELETE {{baseUrl}}/classrooms/{{classroomId}}/announcements/{{announcementId}}
Authorization: Bearer {{accessToken}}

### ================================================================
### Get Classroom Quizzes (Upcoming)
### ================================================================
GET {{baseUrl}}/classrooms/{{classroomId}}/quizzes
Authorization: Bearer {{accessToken}}

### ================================================================
### Get Classroom Quizzes with Pagination
### ================================================================
GET {{baseUrl}}/classrooms/{{classroomId}}/quizzes?page=1&limit=5
Authorization: Bearer {{accessToken}}

### ================================================================
### Test Classroom Flow - Complete Workflow
### ================================================================

### 1. List all classrooms to find your classroom
# @name listClassrooms
GET {{baseUrl}}/classrooms
Authorization: Bearer {{accessToken}}

### Save first classroom ID
@testClassroomId = {{listClassrooms.response.body.data[0].id}}

### 2. Get classroom details
GET {{baseUrl}}/classrooms/{{testClassroomId}}
Authorization: Bearer {{accessToken}}

### 3. View timetable
GET {{baseUrl}}/classrooms/{{testClassroomId}}/timetable
Authorization: Bearer {{accessToken}}

### 4. View announcements
GET {{baseUrl}}/classrooms/{{testClassroomId}}/announcements
Authorization: Bearer {{accessToken}}

### 5. Create announcement (Class Rep)
# @name repAnnouncement
POST {{baseUrl}}/classrooms/{{testClassroomId}}/announcements
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "Week 5 Assignment Reminder",
  "content": "Don't forget that the Week 5 programming assignment is due this Friday at 11:59 PM. Submit via the course portal. Late submissions will incur a 10% penalty per day.",
  "isPinned": false,
  "isUrgent": false
}

### Save rep announcement ID
@repAnnouncementId = {{repAnnouncement.response.body.data.id}}

### 6. Update announcement
PUT {{baseUrl}}/classrooms/{{testClassroomId}}/announcements/{{repAnnouncementId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "Week 5 Assignment Reminder - Extended Deadline",
  "content": "Good news! The Week 5 programming assignment deadline has been extended to Sunday at 11:59 PM. This gives you extra time to refine your solutions.",
  "isPinned": true,
  "isUrgent": false
}

### 7. View updated announcements
GET {{baseUrl}}/classrooms/{{testClassroomId}}/announcements
Authorization: Bearer {{accessToken}}

### 8. Check upcoming quizzes
GET {{baseUrl}}/classrooms/{{testClassroomId}}/quizzes
Authorization: Bearer {{accessToken}}

### 9. Delete announcement (cleanup)
DELETE {{baseUrl}}/classrooms/{{testClassroomId}}/announcements/{{repAnnouncementId}}
Authorization: Bearer {{accessToken}}

### ================================================================
### Error Cases - Classroom Endpoints
### ================================================================

### Try to create announcement without Class Rep role (should fail with 403)
POST {{baseUrl}}/classrooms/{{testClassroomId}}/announcements
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "Unauthorized Announcement",
  "content": "This should fail if user is not a Class Rep"
}

### Try to get non-existent classroom (should fail with 404)
GET {{baseUrl}}/classrooms/00000000-0000-0000-0000-000000000000
Authorization: Bearer {{accessToken}}

### Try to create announcement with missing required fields (should fail with 400)
POST {{baseUrl}}/classrooms/{{testClassroomId}}/announcements
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "Missing Content Field"
}

### Try to update non-existent announcement (should fail with 404)
PUT {{baseUrl}}/classrooms/{{testClassroomId}}/announcements/00000000-0000-0000-0000-000000000000
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "This should fail",
  "content": "Announcement does not exist"
}

### ================================================================
### Additional Tests
### ================================================================

### Health Check
GET {{baseUrl}}/health

### ================================================================
### Error Cases - Test Invalid Requests
### ================================================================

### Invalid Student ID Format (should fail)
POST {{baseUrl}}/auth/send-otp
Content-Type: application/json

{
  "studentId": "12345678"
}

### Non-existent Student (should fail)
POST {{baseUrl}}/auth/send-otp
Content-Type: application/json

{
  "studentId": "PS/XXX/99/9999"
}

### Invalid OTP Code (should fail)
POST {{baseUrl}}/auth/verify-otp
Content-Type: application/json

{
  "studentId": "{{studentId}}",
  "otpCode": "000000"
}

### Missing Authorization Header (should fail)
GET {{baseUrl}}/users/profile

### ================================================================
### Test Other Students
### ================================================================

### Send OTP to Ama Osei
POST {{baseUrl}}/auth/send-otp
Content-Type: application/json

{
  "studentId": "PS/ITC/22/0120"
}

### Send OTP to Kofi Asante
POST {{baseUrl}}/auth/send-otp
Content-Type: application/json

{
  "studentId": "PS/CSC/22/0045"
}

### Send OTP to Abena Boateng
POST {{baseUrl}}/auth/send-otp
Content-Type: application/json

{
  "studentId": "PS/ITC/23/0201"
}
### ================================================================
### USER PROFILE ENDPOINTS - Complete Testing Suite
### ================================================================

### ----------------------------------------------------------------
### 1. Get Current User Profile (Must be authenticated)
### ----------------------------------------------------------------
GET {{baseUrl}}/users/profile
Authorization: Bearer {{accessToken}}

### ----------------------------------------------------------------
### 2. Get User Profile by ID (Public with optional auth)
### Replace with actual user ID from database
### ----------------------------------------------------------------
# @name getUserById
GET {{baseUrl}}/users/profile/12345678-1234-1234-1234-123456789abc
Authorization: Bearer {{accessToken}}

### Get User Profile by ID (Unauthenticated - email masked)
GET {{baseUrl}}/users/profile/12345678-1234-1234-1234-123456789abc

### ----------------------------------------------------------------
### 3. Setup Profile (First time setup after registration)
### This is called after initial OTP verification when needsProfileSetup is true
### ----------------------------------------------------------------
POST {{baseUrl}}/users/profile/setup
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "fullName": "Kwame Mensah",
  "bio": "Computer Science student passionate about AI and web development",
  "program": "Information Technology",
  "classYear": "2026",
  "skills": ["JavaScript", "Python", "React", "Node.js", "Machine Learning"],
  "interests": ["AI/ML", "Web Development", "Mobile Apps", "Cybersecurity"],
  "portfolioUrl": "https://kwamemensah.dev"
}

### Setup Profile - Minimal (Only required fields)
POST {{baseUrl}}/users/profile/setup
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "fullName": "Ama Osei"
}

### ----------------------------------------------------------------
### 4. Update Profile (Update existing profile information)
### ----------------------------------------------------------------
PUT {{baseUrl}}/users/profile
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "fullName": "Kwame Mensah Jr.",
  "bio": "Final year CS student | Full-stack Developer | AI Enthusiast",
  "program": "Computer Science",
  "classYear": "2026",
  "skills": ["JavaScript", "TypeScript", "Python", "React", "Node.js", "AWS", "Docker"],
  "interests": ["AI/ML", "Cloud Computing", "DevOps", "Open Source"],
  "portfolioUrl": "https://kwamemensah.com"
}

### Update Profile - Partial Update
PUT {{baseUrl}}/users/profile
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "bio": "Updated bio - Software Engineer in the making!",
  "portfolioUrl": "https://github.com/kwamemensah"
}

### ----------------------------------------------------------------
### 5. Upload Avatar (Profile Picture)
### NOTE: REST Client doesn't support file uploads well
### Use Postman, Insomnia, or curl for actual file upload testing
### ----------------------------------------------------------------

### cURL Example for Avatar Upload (Run in terminal):
### curl -X POST http://localhost:3000/api/v1/users/avatar \
###   -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
###   -F "avatar=@/path/to/your/image.jpg"

### PowerShell Example for Avatar Upload:
### $headers = @{ "Authorization" = "Bearer YOUR_ACCESS_TOKEN" }
### $uri = "http://localhost:3000/api/v1/users/avatar"
### $filePath = "C:\path\to\image.jpg"
### Invoke-WebRequest -Uri $uri -Method POST -Headers $headers -InFile $filePath -ContentType "multipart/form-data"

### ----------------------------------------------------------------
### 6. Delete Avatar
### ----------------------------------------------------------------
DELETE {{baseUrl}}/users/avatar
Authorization: Bearer {{accessToken}}

### ----------------------------------------------------------------
### 7. Search Users
### ----------------------------------------------------------------

### Search by name
GET {{baseUrl}}/users/search?q=Kwame
Authorization: Bearer {{accessToken}}

### Search by student ID
GET {{baseUrl}}/users/search?q=PS/ITC/22
Authorization: Bearer {{accessToken}}

### Search by program
GET {{baseUrl}}/users/search?q=Computer Science
Authorization: Bearer {{accessToken}}

### Search with pagination
GET {{baseUrl}}/users/search?q=Student&page=1&limit=10
Authorization: Bearer {{accessToken}}

### Get all users (no search query)
GET {{baseUrl}}/users/search?page=1&limit=20
Authorization: Bearer {{accessToken}}

### ----------------------------------------------------------------
### Profile Testing - Error Cases
### ----------------------------------------------------------------

### Setup Profile - Missing required field (should fail)
POST {{baseUrl}}/users/profile/setup
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "bio": "Missing fullName"
}

### Setup Profile - Invalid year format (should fail)
POST {{baseUrl}}/users/profile/setup
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "fullName": "Test User",
  "classYear": "20266"
}

### Update Profile - Invalid data type (should fail)
PUT {{baseUrl}}/users/profile
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "skills": "Should be an array, not a string"
}

### Get Profile - Unauthenticated (should fail)
GET {{baseUrl}}/users/profile

### Upload Avatar - No file provided (should fail)
### This would fail in actual implementation

### Get Non-existent User Profile (should return 404)
GET {{baseUrl}}/users/profile/00000000-0000-0000-0000-000000000000
Authorization: Bearer {{accessToken}}

### ================================================================
### GROUPS & CLUBS ENDPOINTS (7 total)
### ================================================================

### Get All Groups (Public - No Auth Required)
GET {{baseUrl}}/groups
Content-Type: application/json

### Get All Groups with Pagination
GET {{baseUrl}}/groups?page=1&limit=5
Content-Type: application/json

### Get All Groups with Search
GET {{baseUrl}}/groups?search=Tech
Content-Type: application/json

### Get All Groups by Category
GET {{baseUrl}}/groups?category=Technology
Content-Type: application/json

### Get Groups - Authenticated (shows membership status)
GET {{baseUrl}}/groups
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Get Group Categories (Public)
GET {{baseUrl}}/groups/categories
Content-Type: application/json

### Get My Groups (Private - Auth Required)
GET {{baseUrl}}/groups/my-groups
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Get My Groups with Pagination
GET {{baseUrl}}/groups/my-groups?page=1&limit=10
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Get Group by ID (Public - No Auth Required)
### Replace {groupId} with actual group ID from previous response
GET {{baseUrl}}/groups/{groupId}
Content-Type: application/json

### Get Group by ID - Authenticated (shows your role)
### Replace {groupId} with actual group ID
GET {{baseUrl}}/groups/{groupId}
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Get Group Members (Public)
### Replace {groupId} with actual group ID
GET {{baseUrl}}/groups/{groupId}/members
Content-Type: application/json

### Get Group Members with Pagination
### Replace {groupId} with actual group ID
GET {{baseUrl}}/groups/{groupId}/members?page=1&limit=20
Content-Type: application/json

### Join a Group (Private - Auth Required)
### Replace {groupId} with actual group ID
POST {{baseUrl}}/groups/{groupId}/join
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Leave a Group (Private - Auth Required)
### Replace {groupId} with actual group ID
DELETE {{baseUrl}}/groups/{groupId}/join
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### ================================================================
### GROUPS & CLUBS - ERROR CASES
### ================================================================

### Join Group without Authentication (should fail)
POST {{baseUrl}}/groups/{groupId}/join
Content-Type: application/json

### Get Non-existent Group (should return 404)
GET {{baseUrl}}/groups/00000000-0000-0000-0000-000000000000
Content-Type: application/json

### Get Members of Non-existent Group (should return 404)
GET {{baseUrl}}/groups/00000000-0000-0000-0000-000000000000/members
Content-Type: application/json

### Join Non-existent Group (should return 404)
POST {{baseUrl}}/groups/00000000-0000-0000-0000-000000000000/join
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Join Same Group Twice (should return 409 Conflict)
### Run this after successfully joining a group
POST {{baseUrl}}/groups/{groupId}/join
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Leave Group You're Not a Member Of (should return 404)
DELETE {{baseUrl}}/groups/{groupId}/join
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### ================================================================
### NOTIFICATIONS ENDPOINTS (6 total)
### All notification endpoints require authentication
### ================================================================

### Get All Notifications
GET {{baseUrl}}/notifications
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Get Notifications with Pagination
GET {{baseUrl}}/notifications?page=1&limit=10
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Get Unread Notifications Only
GET {{baseUrl}}/notifications?unreadOnly=true
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Get Unread Notifications with Pagination
GET {{baseUrl}}/notifications?unreadOnly=true&page=1&limit=5
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Get Unread Count
GET {{baseUrl}}/notifications/unread-count
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Mark Notification as Read
### Replace {notificationId} with actual notification ID
PUT {{baseUrl}}/notifications/{notificationId}/read
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Mark All Notifications as Read
PUT {{baseUrl}}/notifications/read-all
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Delete a Notification
### Replace {notificationId} with actual notification ID
DELETE {{baseUrl}}/notifications/{notificationId}
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Clear All Read Notifications
DELETE {{baseUrl}}/notifications/clear-read
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### ================================================================
### NOTIFICATIONS - ERROR CASES
### ================================================================

### Get Notifications without Authentication (should fail)
GET {{baseUrl}}/notifications
Content-Type: application/json

### Mark Non-existent Notification as Read (should return 404)
PUT {{baseUrl}}/notifications/00000000-0000-0000-0000-000000000000/read
Authorization: Bearer {{accessToken}}
Content-Type: application/json

### Delete Non-existent Notification (should return 404)
DELETE {{baseUrl}}/notifications/00000000-0000-0000-0000-000000000000
Authorization: Bearer {{accessToken}}
Content-Type: application/json